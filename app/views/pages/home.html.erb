<div class="container mx-auto pt-5 text-center">
  <ul>
    <li>
      <p class="mb-4">
        <a id="verify-button"
                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 border border-blue-700 rounded"
        >Verify
        </a>
      </p>
    </li>
    <li>
      <p class="mb-4">
        <%= link_to "Retrieve Verification Session", verifications_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 border border-blue-700 rounded" %>
      </p>
    </li>
    <li>
      <p class="mb-4">
        <%= link_to "Events", events_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 border border-blue-700 rounded" %>
      </p>
    </li>
  </ul>

  <script type="text/javascript">
    let stripe = Stripe('<%= ENV["STRIP_PUBLIC_KEY"] %>')

    let verifyButton = document.getElementById('verify-button');

    verifyButton.addEventListener('click', function () {
      fetch('<%= create_verification_session_url %>', {
        method: 'POST',
      })
        .then(function (response) {
          console.log('response.json()',response.json())
          return response.json();
        })
        .then(function (session) {
          console.log('stripe.verifyIdentity(session.client_secret)',stripe.verifyIdentity(session.client_secret))
          return stripe.verifyIdentity(session.client_secret);
        })
        .then(function (result) {
          if (result.error) {
            alert(result.error.message);
          } else {
            console.log('success', result)
            // window.location.href = "https://emenu.okkami.com/pre-checkin/000-000-0057d/home";
          }
        })
        .catch(function (error) {
          console.error('Error:', error);
        });
    })
  </script>
</div>
